const fs = require('fs');
const path = require('path');

// 读取文件
const filePath = path.join(__dirname, 'electron-main.cjs');
let content = fs.readFileSync(filePath, 'utf8');

// 定义替换规则（按照出现顺序）
const replacements = [
  // 先替换完整的短语（避免误替换）
  ['不）', '不变'],
  ['相关变）', '相关变量'],
  ['性能优化）', '⚡ 性能优化：'],
  ['输出缓冲）', '输出缓冲区'],
  ['上次发送时）', '上次发送时间'],
  ['确保缓冲区最终会被清）', '确保缓冲区最终会被清空'],
  ['占用）', '占用）\n'],
  ['时）', '时间'],
  ['）=）', '，2=每2'],
  ['个取1个，10=）', '个取1个，10=每10'],
  ['显示应用）', '显示应用名'],
  ['稳定不）', '稳定不变'],
  ['相关变）', '相关变量'],
  // 常见短语
  ['牛马工具�?', '牛马工具集'],
  ['显示应用�?', '显示应用名'],
  ['中心�?', '中心）'],
  ['任务管理�?', '任务管理器'],
  ['通知中心', '通知中心'],
  // 更多模式
  ['采样�?', '采样率'],
  ['接收�?', '接收，'],
  ['个取1个', '个取1个'],
  ['个取1�?', '个取1个'],
  ['0个取1�?', '0个取1个'],
  ['性能优化', '性能优化'],
  ['限流输出到前�?', '限流输出到前端'],
  ['防止大量日志卡死', '防止大量日志卡死'],
  ['输出缓冲�?', '输出缓冲区'],
  ['上次发送时�?', '上次发送时间'],
  ['定时器：确保缓冲区最终会被清�?', '定时器：确保缓冲区最终会被清空'],
  ['统计丢弃的字节数', '统计丢弃的字节数'],
  ['如果正在中断，丢弃输�?', '如果正在中断，丢弃输出'],
  ['关键优化：采样！不是每个数据都接�?', '关键优化：采样！不是每个数据都接收'],
  ['检查缓冲区大小，超过限制就丢弃旧数�?', '检查缓冲区大小，超过限制就丢弃旧数据'],
  ['动态调整采样率：如果频繁溢出，增加采样率（丢弃更多�?', '动态调整采样率：如果频繁溢出，增加采样率（丢弃更多）'],
  ['如果距离上次发送不�?', '如果距离上次发送不足'],
  ['设置定时器，确保最终会发�?', '设置定时器，确保最终会发送'],
  ['立即发�?', '立即发送'],
  ['定期降低采样率（如果数据流量减少�?', '定期降低采样率（如果数据流量减少）'],
  ['强制刷新输出缓冲�?', '强制刷新输出缓冲区'],
  ['清除定时�?', '清除定时器'],
  ['发送缓冲区内容到前�?', '发送缓冲区内容到前端'],
  ['清空缓冲�?', '清空缓冲区'],
  ['秒后降低采样�?', '秒后降低采样率'],
  ['开发模式：使用项目根目�?', '开发模式：使用项目根目录'],
  ['牛马工具�?', '牛马工具集'],
  ['获取图标路径（支持多平台�?', '获取图标路径（支持多平台）'],
  ['生产模式：按优先级尝试多个路�?', '生产模式：按优先级尝试多个路径'],
  ['方案1：extraResources 配置的路径（推荐�?', '方案1：extraResources 配置的路径（推荐）'],
  ['方案2：asarUnpack 解包的路�?', '方案2：asarUnpack 解包的路径'],
  ['方案3：备用路径（某些打包配置�?', '方案3：备用路径（某些打包配置）'],
  ['创建主窗�?', '创建主窗口'],
  ['窗口标题（任务管理器显示�?', '窗口标题（任务管理器显示）'],
  ['窗口图标（任务栏和Alt+Tab显示�?', '窗口图标（任务栏和Alt+Tab显示）'],
  ['牛马工具�?', '牛马工具集'],
  ['允许所有媒体权限请求（包括 desktopCapturer�?', '允许所有媒体权限请求（包括 desktopCapturer）'],
  ['Windows特定配置（根据Electron官方文档�?', 'Windows特定配置（根据Electron官方文档）'],
  ['设置窗口图标（影响任务栏、Alt+Tab、任务管理器�?', '设置窗口图标（影响任务栏、Alt+Tab、任务管理器）'],
  ['设置窗口标题（任务管理器显示�?', '设置窗口标题（任务管理器显示）'],
  ['可选：设置任务栏覆盖图标（用于显示状态，如通知数量�?', '可选：设置任务栏覆盖图标（用于显示状态，如通知数量）'],
  ['性能优化：禁用自动打开DevTools（需要时按F12手动打开�?', '性能优化：禁用自动打开DevTools（需要时按F12手动打开）'],
  ['窗口关闭�?', '窗口关闭时'],
  ['退�?', '退出'],
  ['全�?', '全选'],
  ['开发者工�?', '开发者工具'],
  ['剪贴板监听功�?', '剪贴板监听功能'],
  ['只处理文本，且内容有变化时才发�?', '只处理文本，且内容有变化时才发送'],
  ['00ms检查一�?', '500ms检查一次'],
  ['处理剪贴板监听开�?', '处理剪贴板监听开关'],
  ['所有窗口关闭时退�?', '所有窗口关闭时退出'],
  ['停止剪贴板监�?', '停止剪贴板监听'],
];

// 执行替换
replacements.forEach(([from, to]) => {
  content = content.split(from).join(to);
});

// 保存文件
fs.writeFileSync(filePath, content, 'utf8');
console.log('✅ 编码修复完成！');

